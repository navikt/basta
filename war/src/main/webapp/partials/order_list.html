<div ng-controller="orderListController">
	<h1 class="page-header">Ordrehistorikk
        <div class="form-group pull-right col-sm-3">
                <ui-select ng-model="timespan.selected" theme="bootstrap">
                    <ui-select-match>{{timespan.selected.description}} :
                        <span ng-show="(orders|filter:search|filter:filterDate).length === orders.length" class="alert alert-sm alert-info">{{orders.length}}</span>
                        <span ng-hide="(orders|filter:search|filter:filterDate).length === orders.length" class="alert alert-sm alert-info">{{(orders|filter:search|filter:filterDate).length}} / {{orders.length}}</span>
                         bestillinger
                        <i ng-show="timespan.busy" class="fa fa-spin fa-refresh"></i>
                    </ui-select-match>
                    <ui-select-choices repeat="item in timespan.values | filter: $select.search">
                        <div ng-bind-html="item.description | highlight: $select.search"></div>
                        <small ng-bind-html="item.date | highlight: $select.search"></small>
                    </ui-select-choices>
                </ui-select>
        </div>

    </h1>





     <div class="table-responsive">
	<table class="table" ng-init="predicate = 'created'; reverse = true">
		<thead>
        <tr>
            <td class="col-md-1">
                <div class="input-group">
                    <span class="input-group-addon">
                        <a ng-click="reverse = predicate == (predicate = 'id') && !reverse">#</a>
                    </span>
                    <input ng-model="search.id" class="form-control" placeholder="ID">
                </div>
            </td>
            <td class="col-md-1">
                <div class="input-group">
                    <span class="input-group-addon">
                        <a ng-click="reverse = predicate == (predicate = 'status') && !reverse"><i class="glyphicon glyphicon-play-circle"/></a>
                    </span>
                    <input ng-model="search.status" class="form-control" placeholder="Status">
                </div>
            </td>
            <td class="col-md-2">
                <div class="input-group">
                    <span class="input-group-addon">
                        <a ng-click="reverse = predicate == (predicate = 'nodeType') && !reverse"><i class="glyphicon glyphicon-map-marker"/></a>
                    </span>
                    <input ng-model="search.type" class="form-control" placeholder="Type">
                </div>
            </td>
            <td class="col-md-1">
                <div class="input-group">
                    <span class="input-group-addon">
                        <a ng-click="reverse = predicate == (predicate = 'hostNames') && !reverse"><i class="glyphicon glyphicon-map-marker"/></a>
                    </span>
                    <input ng-model="search.hostNames" class="form-control" placeholder="Hostnavn">
                </div>
            </td>
            <td class="col-md-1">
                <div class="input-group">
                    <span class="input-group-addon">
                        <a ng-click="reverse = predicate == (predicate = 'nodeStatuses') && !reverse"><i class="fa fa-play"/></a>
                    </span>
                    <input ng-model="search.nodeStatuses" class="form-control" placeholder="Nodestatus">
                </div>
            </td>
            <td class="col-md-2">
                <div class="input-group">
                    <span class="input-group-addon">
                        <a ng-click="reverse = predicate == (predicate = 'createdBy') && !reverse"><i class="glyphicon glyphicon-user"/></a>
                    </span>
                    <input ng-model="search.createdByDisplayName" class="form-control" placeholder="Opprettet av">
                </div>
            </td>
            <td class="col-md-1">
                <div class="input-group">
                    <span class="input-group-addon">
                        <a ng-click="reverse = predicate == (predicate = 'created') && !reverse"><i class="glyphicon glyphicon-calendar"/></a>
                    </span>
                    <input ng-model="searchDate" class="form-control" placeholder="Tidspunkt">
                </div>
            </td>
		</thead>
		<tbody>
			<tr ng-repeat="order in orders | orderBy:predicate:reverse | filter:search|filter:filterDate">
				<td><a href="#/order_details/{{order.id}}"><i class="glyphicon glyphicon-folder-open"/> {{order.id}} </a></td>
                <td>
                    <span ng-class="{'label label-radius alert-danger' : order.status === 'ERROR' || order.status==='FAILURE',
                                     'label label-radius alert-warning' : order.status === 'WARNING',
                                     'label label-radius alert-info' : order.status === 'PROCESSING' || order.status ==='NEW',
                                     'label label-radius alert-success' : order.status === 'SUCCESS'}">
                       <i ng-class="
                                       {'glyphicon glyphicon-exclamation-sign': order.status === 'ERROR' || order.status==='FAILURE',
                                       'glyphicon glyphicon-flag': order.status === 'WARNING',
                                       'glyphicon glyphicon-ok': order.status === 'SUCCESS',
                                       'glyphicon glyphicon-refresh': order.status === 'PROCESSING' || order.status ==='NEW'
                                       }
                                     "/>
                                      {{order.status}}
                    </span>
                </td>
                <td>{{order.type}}</td>
                <td><div ng-repeat="node in order.nodes">

                            <a href="#/order_list/?hostname={{node.hostname}}">
                                {{node.hostname}}
                            </a>

                    </div>
                </td>
                <td>
                    <div ng-repeat="node in order.nodes">
                      <span class="label label-radius label-status">

                        <i ng-class="{'fa fa-ban' : node.nodeStatus === 'DECOMMISSIONED',
                                     'fa fa-pause'   : node.nodeStatus === 'STOPPED',
                                     'fa fa-play'    : node.nodeStatus === 'ACTIVE'}"/>
                                      {{node.nodeStatus}}
                    </span>
                    </div>
                </td>
				<td>{{order.createdByDisplayName}}</td>
				<td>{{order.created|date:'yyyy-MM-dd HH:mm:ss'}}</td>

			</tr>
		</tbody>
	</table>
    </div>
</div>
<script>$('.selectpicker').selectpicker();</script>